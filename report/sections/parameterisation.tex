%!TEX root = ../main.tex
\section{Modelling a DC motor}
This section deals with the modelling and parameterisation of a brushed DC motor, specifically the Pittmann 9234 24V servomotor.
Figure \ref{fig:dcmotormodel} is a simple model of a DC motor.
The parameters of this model will be estimated by experimentation.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\linewidth]{graphics/dcmotormodel.png}
	\caption{Simulink model of a brushed DC motor.}
	\label{fig:dcmotormodel}
\end{figure}

For the experiments a test setup is supplied. 
A diagram of the setup can be seen in figure \ref{fig:motorsetup}. 
As can be seen, two motors are connected by the shafts through an external inertia.
The shafts of the two motors will rotate in opposite directions given the same voltage.
To simulate this, a gearbox (called Inverter on the figure) with gear ratio -1:1 is placed between the two motors.
Finally, the Pittmann 9234S007-R1 is equipped with an encoder to allow for monitoring of the angular velocity of the shaft.


\begin{figure}[!h]
	\centering
	\includegraphics[width=.8\linewidth]{graphics/motorsetup.png}
	\caption{Simulink model of the motor setup provided for the project.}
	\label{fig:motorsetup}
\end{figure}

\subsection{Voltage Constant - $K_e$}
\label{sec:voltconstat}
The voltage constant describes the relationship between applied voltage and the resulting angular velocity of the rotor:
\begin{equation}
	\label{eq:voltconstant}
	K_e\omega_r = V_{cc}
\end{equation}
where $\omega_r$ is the angular velocity of the rotor and $V_{cc}$ is the voltage across the motor.
From equation \ref{eq:voltconstant} it is apparent that $K_e$ can be determined if the voltage across the terminals of the motor is measured while the motor is being run at a known velocity.
The experiment is conducted as follows:
A voltage is applied across the terminals of the Pittmann 9234S006.
The resulting velocity of the assembly is monitored using the encoder on the Pittmann 9234S007.
Across the terminals of this motor is now only the back-EMF.
This value is recorded.
Figure \ref{fig:velvsvolt} shows the recorded data. 
As is expected, there is a highly linear relationship between the voltage and velocity.
The final value of $K_e$ is determined by averaging and then dividing the collected data.
$$K_e=\frac{V_{cc}}{\omega_r}=0.0360$$
This value is within 1.2\% of the value given in the datasheet \cite{pittmann}.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\linewidth]{graphics/vvsrpm}
	\caption{Angular velocity of the shaft at different voltages.}
	\label{fig:velvsvolt}
\end{figure}

\subsection{Armature Resistance - $R_a$}
\paragraph{Method 1:}~\\
The armature resistance, $R_a$ in figure \ref{fig:dcmotormodel}, can be found simply by applying Ohm's law.
The current through a resistor is well defined when a voltage is applied across it.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\linewidth]{graphics/raplot}
	\caption{Current as a function of voltage with the rotor blocked.}
	\label{fig:raplot}
\end{figure}

However, when the rotor is spinning, the circuit produces back-EMF.
This counters the input voltage, effectively lowering the current through $R_a$.
In order to avoid this effect the rotor is blocked.
Since, with a blocked rotor, there will be no change in voltage in the system, the inductor acts as a short circuit, reducing the circuit to a voltage across a resistor. 

Figure \ref{fig:raplot} shows the data collected in order to determine the value of the armature resistance.
A voltage is applied across the terminals at 0.5 V.
According to the datasheet \cite{pittmann} the current at maximum allowed continuous torque is 1.75 A.
This current is reached at 5 V, therefore, the measurements stop there.
As can be seen from the figure, a line is fitted to the data.
This is done using the linear least squares method with the following result:
$$I(V)=0.272\cdot V-0.042$$
with $R^2=0.995$.
Since for the plot $I(V)$:
$$R_a = \frac{1}{\text{slope}} = 3.02\Omega$$
However, at $I(0)$ the model will result in a small negative current.
This is obviously not correct; no current would be expected at zero voltage.
Adjusting the model such that it will intersect the origin results in a higher resistance of $R_a=3.43\Omega$.

$$R_a = \frac{1}{\text{slope}} = 3.683\Omega$$
This value is significantly higher, approximately 25\% higher, than the value given in the datasheet.
Additionally, the final data points seem to become irregular.
This is likely caused by the high currents drawn by the motor at these voltages warming the motor and therefore slightly altering the characteristics of the resistor.

For these reasons it has been decided to pursue a different means of determining the armature resistance:
\paragraph{Method 2}~\\
This method makes use of the voltage constant found in section \ref{sec:voltconstat}.
By expanding $V_cc$ in equation \ref{eq:voltconstant} an expression for $R_a$ can be found:
\begin{equation}
	\label{eq:voltconstantexpanded}
	K_e\omega_r = V_{cc} = I_aR_a\quad \Rightarrow \quad R_a = \frac{\omega_rK_e}{I_a}
\end{equation}
Similarly to the experiment in section \ref{sec:voltconstat}, one motor is used to spin the other to speed.
This time, however, the terminals of the Pittmann 9234S007 are connected through a power resistor, $R_e$.
Obviously then:

\begin{eqnarray}
	R_t =& R_a + R_e\\
	R_a =& \frac{\omega_rK_e}{I_a}-R_e
\end{eqnarray}

where $R_t$ is the total resistance in the system.
As the voltage across the terminals of the Pittmann 9234S006 is increased the resulting velocity and current is noted.
Finally, the armature resistance is found to be:
$$R_a = 3.715\Omega$$


\subsection{Motor inductance - $L_a$}
The inductance of the motor, $L_a$ in figure \ref{fig:dcmotormodel}, can be found by looking at the transient response of the stalled motor. 
When the motor is stalled there is no back-EMF in the circuit. The motor can then be modelled as a simple RL-circuit. 
An RL-circuit has a known time constant $\tau$.
$$\tau = \frac{L}{R_{total}}$$
The time onstant is defined as the time it takes for the voltage across the component to rise or fall to $\frac{1}{e}$ of the final value.
Measuring the time constant would require measuring the voltage across the inductor or the resistor in the motor. This is not possible as these are built-in. 
Therefore an extra resistor, $R_e$, was put in series with the motor and the voltage across it was measured by an oscilloscope. 
$$\tau = \frac{L}{R_{total}} = \frac{L_a}{R_a+R_e}$$
Rearraring the formula for $\tau$ yields an expression for $L_a$: 
$$L_a = \tau * (R_a + R_e)$$
To give the circuit a step signal it was given a voltage of 8 V by a power supply and then the terminals of the power supply was  short circuited by connecting the terminals with a wire. Thus giving it a step signal with a initial value of 8 V and a final value of 0 V.
The experiment was repeated 10 times. $\tau$ can be found by locating the time where the measured voltage is equal to $\frac{1}{e}$ of the initial voltage.

\subsubsection{Experiment}
The extra resistor, $R_e$, was measured by a multimeter to have a value of $32.97\Omega$.
Then the circuit was given the step signal while measuring the voltage.
The transient responses measured across $R_e$ can be seen in figure \ref{fig:trans_plot}.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\linewidth]{graphics/transient_32ohm}
	\caption{Transient responses measured across $R_e$. The vertical lines represent the initial voltage, $V_0$, and $\frac{1}{e} \cdot V_0$.}
	\label{fig:trans_plot}
\end{figure}


$\tau$ was found to be 0.713 $\cdot 10^4 s$, by taking the average of the found values from the 10 experiments.
The average value of $L_a$ was then found to be 2.6 mH. The value is only $3.83\%$ higher than the value in the datasheet.

\subsubsection{Discussion}
Only the voltage across $R_e$ is measured, which is problematic as it is assumed in the formula that the transient response is measured across the whole resistance of the circuit. Choosing a value for $R_e$ that is much larger than $R_a$ would minimize the problem.
The experiment was done with values of $R_e$ ranging from $33\Omega$ to $3.3K\Omega$.
Results generally showed that higher values of $R_e$ yielded more difference between the calculated values of $L_a$ and the value given in the datasheet.

\subsection{Motor Inertia - $J_r$}
The inertia of the motor, $J_r$ in figure \ref{fig:dcmotormodel}, can be found by looking at the transient response of the motor. 
It is known from \cite{feedback}, that the inertia of a motor can be calculed by the following equation.
$$J_m = (K_{fm}+\frac{K_m^2}{R_a}) \cdot T$$
Where the time constant T is expressed by:
$$ T = \frac{J_m}{K_{fm}+\frac{K_m^2}{R_a}}$$
T is not easily calculated as $J_r$ is an unknown. Instead it is known that the current at time T can be expressed as:
$$ i_a(T) = \frac{K_{fm} \cdot R_a + K_m^2 \cdot e^{-1}}{K_{fm} \cdot R_a + K_m^2} \cdot \frac{v_{ass}}{R_a} $$
The time constant T can be found by looking at the transient response of the motor. 
The time it takes from the time of the step input to the current falls to the value of $i_a(T)$ is be T.

\subsubsection{Experiment}
An oscilloscope was used to measure the transient response of the motor when given a voltage step input. A current probe was connected to the oscilloscope and the current through the motor was thereby measured.
Step inputs of 1V, 2V, 3V,\dots 10V was used and 5 datasets were collected at each step signal value.  
5 transient responses of the motor given a step input of 7V can be seen in figure \ref{fig:inertia_trans_plot}.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\linewidth]{graphics/transient_response_inertia}
	\caption{Transient responses of the motor given a 7V step input. The horizontal line represent the value of $i_a(T)$ and the vertical line represents T.}
	\label{fig:inertia_trans_plot}
\end{figure}

With a step input of 7V and using the measured values for $K_{fm}$,$R_a$ and $K_m$ the mean value of $i_a(T)$ was calculated to be 0.88 I. 
The mean value of T was then found to be 0.015 s and lastly the mean value of $J_r$, with a step input of 7V, was found to be $6.54 \cdot 10^{-6} \cdot kg \cdot m^2$.

\par
The mean value of $J_r$ from all the experiments with varying step input value was found to be $ 6.508 \cdot 10^{-6} \cdot kg \cdot m^2$ which is $56\%$ higher than the value given in the datasheet. 
\todo[inline]{Mikkel. Recalculate all values with the measured values of Ra, Kfm and so on}